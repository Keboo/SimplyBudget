<windows:BaseWindow x:Class="SimplyBudget.Windows.EditAccountWindow"
                    x:ClassModifier="internal"
                    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:windows="clr-namespace:SimplyBudget.Windows"
                    xmlns:vc="clr-namespace:SimplyBudget.ValueConverter"
                    xmlns:data="clr-namespace:SimplyBudgetShared.Data;assembly=SimplyBudgetShared"
                    xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
                    xmlns:behaviors="clr-namespace:SimplyBudget.Behaviors"
                    xmlns:utilities="clr-namespace:SimplyBudget.Utilities"
                    xmlns:windowsVM="clr-namespace:SimplyBudget.ViewModels.Windows"
                    xmlns:telerik="http://schemas.telerik.com/2008/xaml/presentation" SizeToContent="Height" Width="300">
    <Window.Resources>
        <windowsVM:EditAccountViewModel x:Key="MainViewModel" />
    </Window.Resources>
    <Window.DataContext>
        <StaticResource ResourceKey="MainViewModel"/>
    </Window.DataContext>
    <Window.Style>
        <Style TargetType="{x:Type Window}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsEditing}" Value="False">
                    <Setter Property="Title" Value="Add New Account"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding IsEditing}" Value="True">
                    <Setter Property="Title" Value="Edit Account"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Style>
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition />
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <TextBlock Style="{StaticResource ErrorIndicator}" ToolTip="{Binding NameError}" />
                <TextBlock Text="Name:" Margin="0,0,5,0" Grid.Column="1" VerticalAlignment="Center"/>
                <TextBox Text="{Binding Name}" Style="{StaticResource InputTextBox}" Grid.Column="2"/>
            </Grid>
            <Grid Margin="0,5" utilities:AttachedProperties.BooleanVisibility="{Binding IsEditing}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{Binding LastValidatedDate, StringFormat='Last validated on: {0}', Converter={vc:ShortDateValueConverter}}"/>
                <TextBlock Grid.Column="1">
                    <Hyperlink Command="{Binding MarkAsValidatedCommand}" IsEnabled="{Binding LastValidatedDate, Converter={vc:IsNotTodayValueConverter}}">Validate Now</Hyperlink>
                </TextBlock>
            </Grid>
            <CheckBox IsChecked="{Binding IsDefault}" Content="Default Account" Margin="0,5"/>
            <TextBlock Text="Included Expense Categories:" Margin="0,0,0,5"/>
        </StackPanel>
        <ListBox MinHeight="100" Height="250" ItemsSource="{Binding ExpenseCategories}"
                 SelectionMode="Multiple" Margin="0,5" Grid.Row="1">
            <ListBox.ItemTemplate>
                <DataTemplate DataType="{x:Type data:ExpenseCategory}">
                    <CheckBox IsChecked="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBoxItem}}" Content="{Binding Name}"/>
                </DataTemplate>
            </ListBox.ItemTemplate>
            <i:Interaction.Behaviors>
                <behaviors:SyncSelectedItemsBehavior SelectedItems="{Binding SelectedItems}" />
            </i:Interaction.Behaviors>
        </ListBox>

        <telerik:RadButton Style="{StaticResource SaveButton}" Margin="0,5" Grid.Row="2"/>

    </Grid>
</windows:BaseWindow>
